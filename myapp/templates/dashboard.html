{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Luku Store.nl | Dashboard</title>
    <link
      rel="icon"
      type="image/x-icon"
      href="{% static 'images/favicon.ico' %}"
    />

    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
    />

    <!-- FONT AWESOME -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css"
      integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <!-- END OF FONT AWESOME -->

    <!-- MAIN FONT -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Gloock&family=Poppins:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,400;1,900&display=swap"
      rel="stylesheet"
    />
    <!-- END OF MAIN FONT -->
    <!-- Custom styles for this template -->
    <link href="{% static 'css/dashboard.css' %}" rel="stylesheet" />
  </head>
  <body>
    <header
      class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow"
    >
      <a
        class="navbar-brand col-md-3 col-lg-2 me-0 px-3 fs-6"
        href="{% url 'about_us' %}"
        >Luku Store.nl</a
      >
      <button
        class="navbar-toggler position-absolute d-md-none collapsed"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#sidebarMenu"
        aria-controls="sidebarMenu"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <form class="w-100" action="{% url 'dashboard' %}" method="GET">
        <input
        class="form-control form-control-dark w-100 rounded-0 border-0"
        type="search"
        placeholder="Search"
        aria-label="Search"
        name="query"
        />
      </form>
      <div class="navbar-nav">
        <div class="nav-item text-nowrap">
          <a class="nav-link px-3" href="{% url 'logout' %}">Sign out</a>
        </div>
      </div>
    </header>

    <div class="container-fluid">
      <div class="row">
        <nav
          id="sidebarMenu"
          class="col-md-3 col-lg-2 d-md-block bg-dark sidebar collapse"
        >
          <div class="position-sticky pt-3 sidebar-sticky">
            <ul class="nav flex-column">
              <li class="nav-item">
                <a
                  class="nav-link text-white active"
                  aria-current="page"
                  href="{% url 'dashboard' %}"
                >
                  <span data-feather="home" class="align-text-bottom"></span>
                  Dashboard
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link text-white" href="#orders">
                  <span data-feather="file" class="align-text-bottom"></span>
                  Orders
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link text-white" href="#pills-home-tab">
                  <span
                    data-feather="shopping-cart"
                    class="align-text-bottom"
                  ></span>
                  Products
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link text-white" href="#pills-contact-tab">
                  <span data-feather="users" class="align-text-bottom"></span>
                  Customers
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link text-white" href="#blogs">
                  <span data-feather="layers" class="align-text-bottom"></span>
                  Blogs
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link text-white" href="/admin">
                  <span
                    data-feather="bar-chart-2"
                    class="align-text-bottom"
                  ></span>
                  Admin
                </a>
              </li>
            </ul>

            <h6
              class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-light text-uppercase"
            >
              <span>Add</span>
              <a class="link-secondary" href="#" >
                <span
                  data-feather="plus-circle"
                  class="align-text-bottom"
                ></span>
              </a>
            </h6>
            <ul class="nav flex-column mb-2">
              <li class="nav-item">
                <a class="nav-link text-white" href="{% url 'add' %}">
                  <span
                    data-feather="file-text"
                    class="align-text-bottom"
                  ></span>
                  New Luku
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link text-white" href="{% url 'add' %}">
                  <span
                    data-feather="file-text"
                    class="align-text-bottom"
                  ></span>
                  New Blog
                </a>
              </li>
            </ul>
          </div>
        </nav>

        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
          <div
            class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"
          >
            <h1 class="h2">Dashboard</h1>
            <div class="btn-toolbar mb-2 mb-md-0">
              <div class="btn-group me-2">
                <a
                  href="{% url 'index' %}"
                  class="btn btn-sm btn-outline-dark"
                >
                  Home
                </a>
                <a
                  href="{% url 'store' %}"
                  class="btn btn-sm btn-outline-dark"
                >
                  Store
                </a>
              </div>
              <div class="dropdown">
                <button
                  type="button"
                  class="btn btn-sm btn-outline-dark "
                >
                  <span data-feather="calendar" class="align-text-bottom"></span>
                  Month
                </button>
              </div>
              
            </div>
          </div>

          <h3>Category Chart</h3>
          <div>
            <canvas id="myChart"></canvas>
          </div>

          <hr class="my-3">
          <div class="container">
            <ul class="nav nav-pills nav-tabs" id="pills-tab" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="pills-home-tab" data-bs-toggle="pill" data-bs-target="#pills-home" type="button" role="tab" aria-controls="pills-home" aria-selected="true">All Products</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="pills-profile-tab" data-bs-toggle="pill" data-bs-target="#pills-profile" type="button" role="tab" aria-controls="pills-profile" aria-selected="false">Category</button>
              </li>
              <li class="nav-item  mb-3" role="presentation">
                <button class="nav-link" id="pills-contact-tab" data-bs-toggle="pill" data-bs-target="#pills-contact" type="button" role="tab" aria-controls="pills-contact" aria-selected="false">Customers</button>
              </li>
            </ul>
            <div class="tab-content" id="pills-tabContent">
              <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
                <table class="table table-striped table-sm">
                  <thead>
                    <tr>
                      <th scope="col">ID</th>
                      <th scope="col">Product</th>
                      <th scope="col">Stock</th>
                      <th scope="col">Category</th>
                      <th scope="col">Price</th>
                      <th scope="col">Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for photo in photos %}
                  <tr>
                    <td>#{{ photo.pk }}</td>
                    <td><a class="underline text-dark fw-bold" href="{% url 'photo' photo.pk %}">{{ photo.name }}</a></td>
                    <td>
                      {% if photo.stock <= 1 %}
                      <span><p class="badge rounded-pill bg-danger">Low</p></span>
                      {% else %}
                      <span><p class="badge rounded-pill bg-primary">{{ photo.stock }}</p></span>
                      {% endif %}
                    </td>
                    <td>{{ photo.category }}</td>
                    <td>{{ photo.price }}</td>
                    <td>
                        <!-- Button trigger modal -->
                        <button 
                        style="border: none; background: none"
                        type="button" 
                        href="{% url 'edit' photo.id %}" 
                        class="text-success me-1" 
                        data-bs-toggle="modal" 
                        data-bs-target="#exampleModal{{ photo.id }}">
                        <i class="fa-solid fa-circle-info"></i>
                        </button>

                        <!-- Edit Modal -->
                        <div class="modal fade" id="exampleModal{{ photo.id }}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                          <div class="modal-dialog" role="document">
                              <div class="modal-content">
                              <div class="modal-header">
                                  <h1 class="modal-title fs-5" id="exampleModalLabel{{ photo.id }}">
                                      {{ photo.name }}
                                  </h1>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                                      <span aria-hidden="true"></span>
                                  </button>
                              </div>
                              <div class="modal-body">
                                  <ul class="list-unstyled">
                                      <li>Name: <strong>{{ photo.name }}</strong></li>
                                      <li>Price: <strong>{{ photo.price }}</strong></li>
                                      <li>Type: <strong>{{ photo.type }}</strong></li>
                                      <li>Stock: <span>
                                        {% if photo.stock <= 1 %}
                                        <p class="badge rounded-pill bg-danger">{{ photo.stock }}</p>
                                        {% else %}
                                        <p class="badge rounded-pill bg-primary">{{ photo.stock }}</p>
                                        {% endif %}
                                      </span></li>
                                      <li>Rating: <strong>{{ photo.rating }}</strong></li>
                                      <li>Size: <strong>{{ photo.size }}</strong></li>
                                      <li>Color: <strong>{{ photo.color }}</strong></li>
                                      <li>Brand: <strong>{{ photo.shop }}</strong></li>
                                      <li>Popular: <strong>{{ photo.popular }}</strong></li>
                                      <li>Digital: <strong>{{ photo.digital }}</strong></li>
                                      <li><img height="150" width="auto" class="thumbnail mt-3 rounded bg-light" src="{{ photo.image.url }}" alt="{{ photo.name }}"></li>
                                  </ul>
                              </div>
                              <div class="modal-footer">
                                  <a href="{% url 'edit' photo.id %}" class="btn btn-outline-success">Edit</a>
                                  <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                              </div>
                              </div>
                          </div>
                        </div>

                        <button
                        style="border: none; background: none"
                        data-bs-toggle="modal"
                        data-bs-target="#delete{{ photo.id }}"
                        type="button" 
                        class="text-danger">
                        <i class="fa-solid fa-trash"></i>
                        </button>

                        <!-- Delete Modal -->
                        <div class="modal fade" id="delete{{ photo.id }}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                          <div class="modal-dialog" role="document">
                              <div class="modal-content">
                              <div class="modal-header">
                                  <h1 class="modal-title fs-5" id="delete{{ photo.id }}">
                                    Delete {{ photo.name }}?
                                  </h1>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                                      <span aria-hidden="true"></span>
                                  </button>
                              </div>
                              <div class="modal-body">
                                <p>Are you sure you want to delete {{ photo.name }}?</p>
                              </div>
                              <div class="modal-footer">
                                <form action="{% url 'delete' photo.id %}" method="POST">
                                  {% csrf_token %}
                                  <input type="submit" class="btn btn-danger" value="Delete">
                                </form>
                                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                              </div>
                              </div>
                          </div>
                        </div>

                        </td>
                    </tr>
                  </tr>
                  {% endfor %}
                  </tbody>
                </table>
              </div>
              <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
                <table class="table table-striped table-sm">
                  <thead>
                    <tr>
                      <th scope="col">ID</th>
                      <th scope="col">Category</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for category in categories %}
                    <tr>
                      <td>#{{ category.pk }}</td>
                      <td>{{ category.name }}</td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
              <div class="tab-pane fade" id="pills-contact" role="tabpanel" aria-labelledby="pills-contact-tab">
                <table class="table table-striped table-sm">
                  <thead>
                    <tr>
                      <th scope="col">ID</th>
                      <th scope="col">Customer</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for customer in customers %}
                    <tr>
                      <td>#{{ customer.pk }}</td>
                      <td>{{ customer.name }}</td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          {% if orders %}
          <hr class="my-3">
          <div id="orders" class="container">
            <table class="table table-striped table-sm">
              <h3>Orders </h3>
              <thead>
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">Customer</th>
                  <th scope="col">Order Date</th>
                  <th scope="col">Completed</th>
                  <th scope="col">Receipt</th>
                  <th scope="col">Shipping</th>
                  <th scope="col">Quantity</th>
                  <th scope="col">Total</th>
                </tr>
              </thead>
              <tbody>
                {% for order in orders %}
                <tr>
                  <td>{{ order.pk }}</td>
                  <td>{{ order.customer|capfirst }}</td>
                  <td>{{ order.date_ordered }}</td>
                  <td>{{ order.complete }}</td>
                  <td>#{{ order.pk}}{{ order.transaction_id }}</td>
                  <td>{{ order.shipping }}</td>
                  <td>{{ order.get_cart_items }}</td>
                  <td>{{ order.get_cart_total }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <h1>No orders</h1>
          {% endif %}


          <hr class="my-3">
          <div id="blogs" class="container">
            <table class="table table-striped table-sm">
              <h3>Blogs</h3>
              <thead>
                <tr>
                  <th scope="col">Blog No.</th>
                  <th scope="col">Blog Title</th>
                  <th scope="col">Author</th>
                  <th scope="col">Brand</th>
                  <th scope="col">Published</th>
                  <th scope="col">Edit</th>
                </tr>
              </thead>
              <tbody>
                {% for blog in blogs %}
                <tr>
                  <td>#{{ blog.pk }}</td>
                  <td><a class="underline fw-bold text-dark" href="{% url 'blog_detail' blog.pk %}">{{ blog.title }}</a></td>
                  <td>{{ blog.author }}</td>
                  <td>{{ blog.brand }}</td>
                  <td>{{ blog.pub_date }}</td>
                  <td><a class="underline text-secondary" 
                        href="#"><i class="fa-solid fa-pencil"></i></a></td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </main>
      </div>
    </div>
    <!-- Chart JS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
      const ctx = document.getElementById("myChart");

      // Parse the JSON data from the server
      const labels = JSON.parse('{{ category_json|escapejs }}');
      const data = {
        labels: labels,
        datasets: [
          {
            label: "Number of items in each category",
            data: [65, 59, 80, 81, 56, 55, 40, 10, 6, 58, 15, 30, 11, 45, 9],
            backgroundColor: [
              "rgba(255, 99, 132, 0.2)",
              "rgba(255, 159, 64, 0.2)",
              "rgba(255, 205, 86, 0.2)",
              "rgba(75, 192, 192, 0.2)",
              "rgba(54, 162, 235, 0.2)",
              "rgba(153, 102, 255, 0.2)",
              "rgba(201, 203, 207, 0.2)",
            ],
            borderColor: [
              "rgb(255, 99, 132)",
              "rgb(255, 159, 64)",
              "rgb(255, 205, 86)",
              "rgb(75, 192, 192)",
              "rgb(54, 162, 235)",
              "rgb(153, 102, 255)",
              "rgb(201, 203, 207)",
            ],
            borderWidth: 1,
          },
        ],
      };

      new Chart(ctx, {
        type: "bar",
        data: data,
        options: {
          scales: {
            y: {
              beginAtZero: true,
            },
          },
        },
      });
    </script>
    <!-- End of Chart JS -->
    <script src="../assets/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

    <script
      src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js"
      integrity="sha384-uO3SXW5IuS1ZpFPKugNNWqTZRRglnUJK6UAZ/gxOX80nxEkN9NcGZTftn6RzhGWE"
      crossorigin="anonymous"
    ></script>
    <script src="{% static 'js/dashboard.js' %}"></script>
  </body>
</html>
